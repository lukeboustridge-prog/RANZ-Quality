---
phase: 13-programme-enrolment
plan: 03
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - src/components/dashboard/programme-badge.tsx
  - src/app/(dashboard)/dashboard/page.tsx
  - src/app/verify/[businessId]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard displays RoofWright programme status badge prominently when enrolled"
    - "Public verification page shows RoofWright programme status for enrolled organisations"
    - "Non-enrolled or PENDING/SUSPENDED orgs do not show programme info on public page"
  artifacts:
    - path: "src/components/dashboard/programme-badge.tsx"
      provides: "Programme status badge component"
      contains: "ProgrammeBadge"
    - path: "src/app/(dashboard)/dashboard/page.tsx"
      provides: "Dashboard with programme badge integrated"
      contains: "ProgrammeBadge"
    - path: "src/app/verify/[businessId]/page.tsx"
      provides: "Public verification showing programme status"
      contains: "RoofWright"
  key_links:
    - from: "src/app/(dashboard)/dashboard/page.tsx"
      to: "src/components/dashboard/programme-badge.tsx"
      via: "component import and render"
      pattern: "import.*ProgrammeBadge"
    - from: "src/app/verify/[businessId]/page.tsx"
      to: "prisma.organization"
      via: "include programmeEnrolment in query"
      pattern: "programmeEnrolment"
---

<objective>
Add the RoofWright programme badge to the member dashboard and show programme status on the public verification page so that enrolled organisations and their clients can see programme membership.

Purpose: Programme visibility is the user-facing payoff -- members see their status prominently, and the public can verify it. This completes the member-facing and public-facing programme experience.

Output: Dashboard badge component, updated dashboard page, updated public verification page.
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-programme-enrolment/13-01-SUMMARY.md
@src/app/(dashboard)/dashboard/page.tsx
@src/app/verify/[businessId]/page.tsx
@src/components/dashboard/compliance-score.tsx
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dashboard programme badge component</name>
  <files>
    src/components/dashboard/programme-badge.tsx
    src/app/(dashboard)/dashboard/page.tsx
  </files>
  <action>
    1. Create src/components/dashboard/programme-badge.tsx:
       - Server Component (NOT "use client" -- it receives data as props from the server page)
       - Props: `{ enrolment: { status: ProgrammeEnrolmentStatus; activeSince: Date | null; anniversaryDate: Date | null } | null }`
       - If enrolment is null: render nothing (org hasn't applied yet) -- return null
       - If enrolment exists, render a prominent badge/card:
         - ACTIVE status: Green banner/card with Award icon, "RoofWright Programme Member" title, "Active since {date}" subtitle, with a subtle shield/checkmark graphic. This should be visually prominent -- it's the programme's key value indicator.
         - PENDING status: Yellow/amber card, "RoofWright Programme - Application Pending", "Your application is under review"
         - RENEWAL_DUE status: Amber/orange card with warning icon, "RoofWright Programme - Renewal Due", "Your annual renewal is due on {anniversaryDate}"
         - SUSPENDED status: Red card, "RoofWright Programme - Suspended", link to /programme for details
         - WITHDRAWN: Do not render (return null)
       - Use Tailwind classes, Card from @/components/ui/card, Badge from @/components/ui/badge
       - Import Award, CheckCircle, AlertTriangle, XCircle from lucide-react as status icons
       - Format dates with date-fns format()

    2. Update src/app/(dashboard)/dashboard/page.tsx:
       - Add programmeEnrolment to the Organization include query:
         ```typescript
         programmeEnrolment: {
           select: { status: true, activeSince: true, anniversaryDate: true }
         }
         ```
       - Import ProgrammeBadge from @/components/dashboard/programme-badge
       - Render ProgrammeBadge at the TOP of the dashboard content (before StatsCards), passing organization.programmeEnrolment as the enrolment prop
       - This makes the programme status the FIRST thing the org admin sees
  </action>
  <verify>
    Run `pnpm typecheck` passes.
    Run `pnpm build` succeeds.
    Dashboard shows programme badge when enrolment exists.
    Dashboard shows nothing extra when no enrolment exists.
  </verify>
  <done>
    ProgrammeBadge component renders status-appropriate badge with correct colors and icons.
    Dashboard displays programme badge prominently at top of page.
    Non-enrolled orgs see no badge (null render).
  </done>
</task>

<task type="auto">
  <name>Task 2: Public verification page programme status</name>
  <files>
    src/app/verify/[businessId]/page.tsx
  </files>
  <action>
    1. Update src/app/verify/[businessId]/page.tsx:
       - Add programmeEnrolment to the db.organization.findUnique include:
         ```typescript
         programmeEnrolment: {
           select: { status: true, activeSince: true, anniversaryDate: true }
         }
         ```
       - After the "Verification Banner" section (the green "Verified RANZ Member" card), add a "RoofWright Programme" section:
         - Only show if programmeEnrolment exists AND status is ACTIVE or RENEWAL_DUE
         - Render a card with Award icon, "RoofWright Quality Programme" title
         - Show "Active Member" badge (green) for ACTIVE status
         - Show "Member since {activeSince formatted}" text
         - Brief description: "This business participates in the RANZ RoofWright Quality Programme, demonstrating commitment to advanced roofing standards and ongoing professional development."
         - Do NOT show programme info if status is PENDING, SUSPENDED, or WITHDRAWN (these are internal states)
       - Use the same Card/CardContent/Badge patterns already in the verify page
  </action>
  <verify>
    Run `pnpm typecheck` passes.
    Run `pnpm build` succeeds.
    Verify page shows RoofWright section for ACTIVE enrolments.
    Verify page does NOT show programme section for non-enrolled orgs.
  </verify>
  <done>
    Public verification page shows "RoofWright Quality Programme" card for ACTIVE/RENEWAL_DUE orgs.
    Non-enrolled or PENDING/SUSPENDED orgs do not show programme info on public page.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. `pnpm build` succeeds
3. Dashboard shows programme badge for enrolled orgs
4. Dashboard shows nothing for non-enrolled orgs
5. Public verification shows RoofWright section for ACTIVE orgs
6. Public verification hides programme section for non-enrolled/PENDING/SUSPENDED orgs
</verification>

<success_criteria>
- Dashboard prominently displays RoofWright programme status badge at top of page
- Badge renders correctly for all 4 visible statuses (ACTIVE, PENDING, RENEWAL_DUE, SUSPENDED)
- WITHDRAWN and null enrolment render nothing (no empty card)
- Public verification page shows programme membership for ACTIVE/RENEWAL_DUE orgs only
- Build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/13-programme-enrolment/13-03-SUMMARY.md`
</output>
