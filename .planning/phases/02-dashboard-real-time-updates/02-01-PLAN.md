---
phase: 02-dashboard-real-time-updates
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(dashboard)/dashboard/page.tsx
  - src/components/dashboard/compliance-score.tsx
  - src/components/dashboard/dimension-indicators.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard compliance indicators show Insurance, Personnel, Documents, Audit dimension scores"
    - "Each dimension indicator shows score percentage from actual breakdown data"
    - "Dimension indicators reflect real status (green/yellow/red) based on dimension-specific scores"
  artifacts:
    - path: "src/components/dashboard/dimension-indicators.tsx"
      provides: "Four-card grid showing dimension-specific compliance scores"
      exports: ["DimensionIndicators"]
    - path: "src/app/(dashboard)/dashboard/page.tsx"
      provides: "Server Component fetching full ComplianceResult"
      contains: "calculateComplianceScore"
    - path: "src/components/dashboard/compliance-score.tsx"
      provides: "Overall score display (refactored to remove inline dimension indicators)"
      contains: "ComplianceScore"
  key_links:
    - from: "src/app/(dashboard)/dashboard/page.tsx"
      to: "calculateComplianceScore"
      via: "import from @/lib/compliance-v2"
      pattern: "calculateComplianceScore\\(organization\\.id\\)"
    - from: "src/components/dashboard/dimension-indicators.tsx"
      to: "ComplianceBreakdown"
      via: "type import from @/lib/compliance-v2"
      pattern: "import type.*ComplianceBreakdown"
---

<objective>
Display dimension-specific compliance indicators on the dashboard using actual breakdown data from compliance-v2.ts

Purpose: Requirement DASH-01 specifies dashboard displays accurate compliance indicators per dimension (insurance, personnel, documents, audits) based on actual data, not overall score. Currently the dashboard shows hardcoded checks like `score >= 80` for insurance when it should show the actual insurance dimension score.

Output:
- Dashboard Server Component fetches full ComplianceResult with breakdown
- New DimensionIndicators client component shows 4-card grid with Insurance, Personnel, Documentation, Audits
- Each card shows actual dimension score (e.g., Insurance: 85%) with correct status indicator
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-dashboard-real-time-updates/02-RESEARCH.md
@src/lib/compliance-v2.ts
@src/app/(dashboard)/dashboard/page.tsx
@src/components/dashboard/compliance-score.tsx
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update dashboard page to fetch full ComplianceResult</name>
  <files>src/app/(dashboard)/dashboard/page.tsx</files>
  <action>
Import calculateComplianceScore from @/lib/compliance-v2. After fetching organization, call calculateComplianceScore(organization.id) to get the full ComplianceResult with breakdown.

Replace current prop passing to use breakdown data:
- Pass complianceResult.breakdown to new DimensionIndicators component
- Pass complianceResult.overallScore to ComplianceScore (keep existing tier prop)
- Pass complianceResult.issues to ActionItems (derive action items from issues instead of manual logic)

Import new DimensionIndicators component from @/components/dashboard/dimension-indicators.

Update the JSX structure:
- Keep StatsCards at top
- Add DimensionIndicators grid below StatsCards
- Keep ComplianceScore and ExpiringItems in the 2-column grid
- ActionItems derived from complianceResult.issues at bottom

Remove the manual action item building logic (lines 49-92) since issues from compliance-v2.ts already identify all gaps.
  </action>
  <verify>
TypeScript compiles without errors: npm run build shows no errors in dashboard/page.tsx
Dashboard page renders with console showing calculateComplianceScore was called
  </verify>
  <done>
Dashboard page imports and calls calculateComplianceScore, passes breakdown prop to DimensionIndicators component
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DimensionIndicators component</name>
  <files>src/components/dashboard/dimension-indicators.tsx</files>
  <action>
Create new client component at src/components/dashboard/dimension-indicators.tsx that displays four dimension cards.

Import types:
- import type { ComplianceBreakdown } from "@/lib/compliance-v2"
- import { getComplianceStatusLevel, COMPLIANCE_STATUS_METADATA } from "@/types"
- import { cn } from "@/lib/utils"

Component structure:
```typescript
"use client";

interface DimensionIndicatorsProps {
  breakdown: ComplianceBreakdown;
}

export function DimensionIndicators({ breakdown }: DimensionIndicatorsProps) {
  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      <DimensionCard
        label="Insurance"
        score={breakdown.insurance.score}
        icon={<ShieldIcon />}
        details={formatInsuranceDetails(breakdown.insurance)}
      />
      <DimensionCard
        label="Personnel"
        score={breakdown.personnel.score}
        icon={<UsersIcon />}
        details={formatPersonnelDetails(breakdown.personnel)}
      />
      <DimensionCard
        label="Documentation"
        score={breakdown.documentation.score}
        icon={<FileTextIcon />}
        details={formatDocumentationDetails(breakdown.documentation)}
      />
      <DimensionCard
        label="Audits"
        score={breakdown.audit.score}
        icon={<ClipboardCheckIcon />}
        details={formatAuditDetails(breakdown.audit)}
      />
    </div>
  );
}
```

DimensionCard subcomponent:
- Takes label, score, icon, details props
- Uses getComplianceStatusLevel(score) to get status
- Uses COMPLIANCE_STATUS_METADATA[status] for colors
- Shows score as percentage with colored indicator dot
- Shows details text below score

Helper functions:
- formatInsuranceDetails: Shows "X active policies" from policies.filter(p => p.isValid).length
- formatPersonnelDetails: Shows "X verified LBPs" from details.lbpVerifiedCount
- formatDocumentationDetails: Shows "X/19 elements complete" from elements.filter(e => e.hasApprovedDoc).length
- formatAuditDetails: Shows last audit date or "No audits yet"

Use lucide-react icons: Shield, Users, FileText, ClipboardCheck
  </action>
  <verify>
TypeScript compiles: npm run build shows no errors
Component exports DimensionIndicators: grep for "export function DimensionIndicators"
  </verify>
  <done>
DimensionIndicators component exists showing 4 cards with dimension scores from breakdown data, using central threshold constants for status colors
  </done>
</task>

<task type="auto">
  <name>Task 3: Refactor ComplianceScore to focus on overall score</name>
  <files>src/components/dashboard/compliance-score.tsx</files>
  <action>
Remove the inline StatusItem components from ComplianceScore since dimension indicators are now in DimensionIndicators component.

Current component (lines 132-148) has hardcoded StatusItem checks:
- Insurance: score >= 80 (should be removed, now in DimensionIndicators)
- Personnel: score >= COMPLIANCE_THRESHOLDS.AT_RISK (should be removed)
- QMS Documentation: score >= 60 (should be removed)

Simplify the component to focus on:
1. Circular progress showing overall score
2. Certification tier badge
3. Text summary of compliance status

Remove:
- StatusItem component definition entirely
- The flex-1 space-y-3 div containing StatusItem calls

Keep:
- Circular SVG progress indicator with color gradient
- Tier badge (MASTER_ROOFER, CERTIFIED, ACCREDITED)
- Title "Compliance Status"

The overall score visualization remains the same, we're just removing the dimension indicators that are now separate.

Update the layout: Instead of flex items-center gap-8, make the circular progress centered with tier badge and status text below.
  </action>
  <verify>
Component compiles without TypeScript errors
StatusItem is removed: grep for "StatusItem" returns no results in compliance-score.tsx
  </verify>
  <done>
ComplianceScore component shows only overall score with circular progress and tier badge, no inline dimension indicators
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. TypeScript check:
   ```bash
   npx tsc --noEmit 2>&1 | grep -E "(error|Error)" || echo "No errors"
   ```

2. Dashboard renders with dimension cards:
   - Visit /dashboard
   - Verify 4 dimension cards appear: Insurance, Personnel, Documentation, Audits
   - Each card shows percentage score
   - Colors match actual dimension scores (green >= 90, yellow >= 70, red < 70)

3. Overall score still displays:
   - Circular progress shows organization.complianceScore
   - Tier badge shows certification tier
</verification>

<success_criteria>
- Dashboard page calls calculateComplianceScore and passes breakdown to DimensionIndicators
- DimensionIndicators component shows 4 cards with actual dimension scores
- Each card uses getComplianceStatusLevel for correct color coding
- ComplianceScore component focuses only on overall score display
- No hardcoded score comparisons like "score >= 80" for dimension status
</success_criteria>

<output>
After completion, create `.planning/phases/02-dashboard-real-time-updates/02-01-SUMMARY.md`
</output>
