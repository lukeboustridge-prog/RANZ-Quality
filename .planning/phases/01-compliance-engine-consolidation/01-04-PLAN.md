---
phase: 01-compliance-engine-consolidation
plan: 04
type: execute
wave: 1
depends_on: []
files_modified: [src/lib/notifications.ts]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Compliance thresholds (90%/70%) defined in central constants file imported by all components"
  artifacts:
    - path: "src/lib/notifications.ts"
      provides: "Notification dispatch with consistent threshold usage"
      contains: "COMPLIANCE_THRESHOLDS.AT_RISK"
  key_links:
    - from: "src/lib/notifications.ts"
      to: "src/types/index.ts"
      via: "import COMPLIANCE_THRESHOLDS"
      pattern: "import.*COMPLIANCE_THRESHOLDS.*from.*@/types"
---

<objective>
Replace hardcoded compliance threshold (70) in notifications.ts with COMPLIANCE_THRESHOLDS.AT_RISK constant

Purpose: Close verification gap from Phase 01 - notifications.ts was overlooked during initial consolidation and still uses hardcoded `< 70` comparisons instead of the central COMPLIANCE_THRESHOLDS constant.
Output: notifications.ts imports and uses COMPLIANCE_THRESHOLDS.AT_RISK for compliance alert priority and SMS trigger decisions
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-compliance-engine-consolidation/01-VERIFICATION.md

# Source files
@src/lib/notifications.ts
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire notifications.ts to central COMPLIANCE_THRESHOLDS constant</name>
  <files>src/lib/notifications.ts</files>
  <action>
1. Add COMPLIANCE_THRESHOLDS to the existing import from "@/types" at line 4-8:
   ```typescript
   import type {
     NotificationType,
     NotificationChannel,
     NotificationPriority,
   } from "@/types";
   ```
   Change to:
   ```typescript
   import {
     COMPLIANCE_THRESHOLDS,
     type NotificationType,
     type NotificationChannel,
     type NotificationPriority,
   } from "@/types";
   ```
   Note: Change `import type` to `import` with `type` keyword on individual types since we're now importing a runtime value (COMPLIANCE_THRESHOLDS).

2. Line 371 - Replace hardcoded threshold in notifyComplianceAlert priority determination:
   FROM: `complianceScore < 70 ? "CRITICAL" : "HIGH"`
   TO:   `complianceScore < COMPLIANCE_THRESHOLDS.AT_RISK ? "CRITICAL" : "HIGH"`

3. Line 384 - Replace hardcoded threshold in SMS trigger condition:
   FROM: `if (ownerPhone && complianceScore < 70)`
   TO:   `if (ownerPhone && complianceScore < COMPLIANCE_THRESHOLDS.AT_RISK)`
  </action>
  <verify>
1. Run grep to confirm no remaining hardcoded 70 thresholds:
   `grep -n "< 70" src/lib/notifications.ts` should return no matches

2. Run grep to confirm COMPLIANCE_THRESHOLDS is imported:
   `grep -n "COMPLIANCE_THRESHOLDS" src/lib/notifications.ts` should show import and two usage sites

3. TypeScript compilation passes:
   `npx tsc --noEmit src/lib/notifications.ts`
  </verify>
  <done>
- COMPLIANCE_THRESHOLDS imported from @/types
- Line 371 uses COMPLIANCE_THRESHOLDS.AT_RISK for priority determination
- Line 384 uses COMPLIANCE_THRESHOLDS.AT_RISK for SMS trigger
- No hardcoded `< 70` comparisons remain in notifications.ts
  </done>
</task>

</tasks>

<verification>
After completion:
1. `grep -rn "< 70" src/lib/notifications.ts` returns empty (no matches)
2. `grep -n "COMPLIANCE_THRESHOLDS" src/lib/notifications.ts` shows 3 lines (1 import + 2 usages)
3. `npx tsc --noEmit` passes without errors
4. Re-run phase verification: all 4/4 must-haves should now pass
</verification>

<success_criteria>
- notifications.ts imports COMPLIANCE_THRESHOLDS from @/types
- Both compliance threshold checks (lines ~371, ~384) use COMPLIANCE_THRESHOLDS.AT_RISK
- TypeScript compiles without errors
- Phase 01 verification gaps reduced from 1 to 0
</success_criteria>

<output>
After completion, create `.planning/phases/01-compliance-engine-consolidation/01-04-SUMMARY.md`
</output>
