---
phase: 01-compliance-engine-consolidation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/components/dashboard/compliance-score.tsx
  - src/app/verify/[businessId]/page.tsx
  - src/app/(admin)/admin/members/page.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard compliance score component uses central constants for all threshold checks"
    - "Verify page uses central constants for compliance status determination"
    - "Admin members page uses central constants for score color and status label"
    - "All UI components display identical compliance status for the same score value"
  artifacts:
    - path: "src/components/dashboard/compliance-score.tsx"
      provides: "Dashboard compliance display using central constants"
      contains: "COMPLIANCE_THRESHOLDS"
    - path: "src/app/verify/[businessId]/page.tsx"
      provides: "Public verification page using central constants"
      contains: "getComplianceStatusLevel"
    - path: "src/app/(admin)/admin/members/page.tsx"
      provides: "Admin members list using central constants"
      contains: "COMPLIANCE_THRESHOLDS"
  key_links:
    - from: "src/components/dashboard/compliance-score.tsx"
      to: "src/types/index.ts"
      via: "import COMPLIANCE_THRESHOLDS"
      pattern: "import.*COMPLIANCE_THRESHOLDS.*from.*@/types"
    - from: "src/app/verify/[businessId]/page.tsx"
      to: "src/types/index.ts"
      via: "import getComplianceStatusLevel"
      pattern: "import.*getComplianceStatusLevel.*from.*@/types"
---

<objective>
Migrate UI components to use central compliance constants, eliminating hardcoded threshold values.

Purpose: COMP-02 requires compliance thresholds defined in a central constants file and used consistently across all components. This ensures dashboard and verification pages always agree on what "compliant" means.

Output: Updated compliance-score.tsx, verify page, and admin members page - all importing from @/types instead of using magic numbers.
</objective>

<execution_context>
@C:\Users\LukeBoustridge\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\LukeBoustridge\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-compliance-engine-consolidation/01-RESEARCH.md

# Prior plan summary (contains central constants)
@.planning/phases/01-compliance-engine-consolidation/01-01-SUMMARY.md

# Source files to update
@src/components/dashboard/compliance-score.tsx
@src/app/verify/[businessId]/page.tsx
@src/app/(admin)/admin/members/page.tsx
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update compliance-score.tsx to use central constants</name>
  <files>src/components/dashboard/compliance-score.tsx</files>
  <action>
Update src/components/dashboard/compliance-score.tsx to use central constants:

1. Add import at top of file (after existing imports):
   ```typescript
   import { COMPLIANCE_THRESHOLDS, getComplianceStatusLevel, COMPLIANCE_STATUS_METADATA } from "@/types";
   ```

2. Replace the getScoreColor function (around line 12-16):
   ```typescript
   const getScoreColor = (score: number) => {
     const status = getComplianceStatusLevel(score);
     return COMPLIANCE_STATUS_METADATA[status].textColor;
   };
   ```

3. Replace the getGradient function (around line 18-23):
   ```typescript
   const getGradient = (score: number) => {
     const status = getComplianceStatusLevel(score);
     return COMPLIANCE_STATUS_METADATA[status].bgGradient;
   };
   ```

4. Replace ALL occurrences of `score >= 90` with `score >= COMPLIANCE_THRESHOLDS.COMPLIANT`

5. Replace ALL occurrences of `score >= 70` with `score >= COMPLIANCE_THRESHOLDS.AT_RISK`

Search for these patterns in the file and replace each one:
- `score >= 90` -> `score >= COMPLIANCE_THRESHOLDS.COMPLIANT`
- `score >= 70` -> `score >= COMPLIANCE_THRESHOLDS.AT_RISK`

Expected locations to update (verify line numbers may differ):
- Lines 91-93 (Compliant text color conditional)
- Lines 99-101 (Progress bar indicator)
- Lines 110-112 (Badge ring colors)
- Lines 136-137 (Personnel indicator)

IMPORTANT: Maintain the exact same behavior - only replace the hardcoded numbers with constants.
  </action>
  <verify>
Verify import added:
```bash
cd "C:\Users\LukeBoustridge\Projects\RANZ\RANZ Quality Program" && grep -n "COMPLIANCE_THRESHOLDS" src/components/dashboard/compliance-score.tsx | head -5
```
Verify no hardcoded 90/70 remain:
```bash
grep -n "score >= 90\|score >= 70\|>= 90\|>= 70" src/components/dashboard/compliance-score.tsx && echo "FAIL: Hardcoded values remain" || echo "PASS: No hardcoded thresholds"
```
TypeScript compiles:
```bash
npx tsc --noEmit --skipLibCheck 2>&1 | head -20
```
  </verify>
  <done>
- COMPLIANCE_THRESHOLDS, getComplianceStatusLevel, COMPLIANCE_STATUS_METADATA imported from @/types
- getScoreColor function uses getComplianceStatusLevel helper
- getGradient function uses COMPLIANCE_STATUS_METADATA
- All `score >= 90` replaced with `score >= COMPLIANCE_THRESHOLDS.COMPLIANT`
- All `score >= 70` replaced with `score >= COMPLIANCE_THRESHOLDS.AT_RISK`
- No hardcoded threshold values (90, 70) remain in file
  </done>
</task>

<task type="auto">
  <name>Task 2: Update verify page to use central constants</name>
  <files>src/app/verify/[businessId]/page.tsx</files>
  <action>
Update src/app/verify/[businessId]/page.tsx to use central constants:

1. Add import at top of file (with existing @/types imports if any, or add new import):
   ```typescript
   import { COMPLIANCE_THRESHOLDS, getComplianceStatusLevel, COMPLIANCE_STATUS_METADATA } from "@/types";
   ```

2. Replace ALL occurrences of `organization.complianceScore >= 90` with:
   `organization.complianceScore >= COMPLIANCE_THRESHOLDS.COMPLIANT`

3. Replace ALL occurrences of `organization.complianceScore >= 70` with:
   `organization.complianceScore >= COMPLIANCE_THRESHOLDS.AT_RISK`

Expected locations (around lines 142-166):
- Line 142: Color conditional (green/yellow/red bg colors)
- Line 144: Second part of color conditional
- Lines 151-153: Badge/icon conditional
- Lines 164-166: Status text conditional

Pattern to search and replace:
- `organization.complianceScore >= 90` -> `organization.complianceScore >= COMPLIANCE_THRESHOLDS.COMPLIANT`
- `organization.complianceScore >= 70` -> `organization.complianceScore >= COMPLIANCE_THRESHOLDS.AT_RISK`

IMPORTANT: Preserve the ternary operator structure - only replace the numeric thresholds.
  </action>
  <verify>
Verify import added:
```bash
cd "C:\Users\LukeBoustridge\Projects\RANZ\RANZ Quality Program" && grep -n "COMPLIANCE_THRESHOLDS" src/app/verify/\\[businessId\\]/page.tsx | head -5
```
Verify no hardcoded 90/70 remain:
```bash
grep -n "complianceScore >= 90\|complianceScore >= 70" src/app/verify/\\[businessId\\]/page.tsx && echo "FAIL: Hardcoded values remain" || echo "PASS: No hardcoded thresholds"
```
TypeScript compiles:
```bash
npx tsc --noEmit --skipLibCheck 2>&1 | head -20
```
  </verify>
  <done>
- COMPLIANCE_THRESHOLDS imported from @/types
- All `complianceScore >= 90` replaced with `complianceScore >= COMPLIANCE_THRESHOLDS.COMPLIANT`
- All `complianceScore >= 70` replaced with `complianceScore >= COMPLIANCE_THRESHOLDS.AT_RISK`
- No hardcoded threshold values remain in file
  </done>
</task>

<task type="auto">
  <name>Task 3: Update admin members page to use central constants</name>
  <files>src/app/(admin)/admin/members/page.tsx</files>
  <action>
Update src/app/(admin)/admin/members/page.tsx to use central constants:

1. Add import at top of file:
   ```typescript
   import { COMPLIANCE_THRESHOLDS, getComplianceStatusLevel, COMPLIANCE_STATUS_METADATA } from "@/types";
   ```

2. Replace the getScoreColor function (around line 67-70):
   ```typescript
   function getScoreColor(score: number): string {
     const status = getComplianceStatusLevel(score);
     return COMPLIANCE_STATUS_METADATA[status].textColor;
   }
   ```

3. Replace the getScoreLabel function (around line 73-76):
   ```typescript
   function getScoreLabel(score: number): string {
     const status = getComplianceStatusLevel(score);
     return COMPLIANCE_STATUS_METADATA[status].label;
   }
   ```

These functions currently have hardcoded `score >= 90` and `score >= 70` checks. Replace with the helper function that uses central constants.

IMPORTANT: The functions may be defined as arrow functions or regular functions. Convert them to use getComplianceStatusLevel regardless of current syntax.
  </action>
  <verify>
Verify import added:
```bash
cd "C:\Users\LukeBoustridge\Projects\RANZ\RANZ Quality Program" && grep -n "COMPLIANCE_THRESHOLDS\|getComplianceStatusLevel" src/app/\\(admin\\)/admin/members/page.tsx | head -5
```
Verify no hardcoded 90/70 in functions:
```bash
grep -n "score >= 90\|score >= 70" src/app/\\(admin\\)/admin/members/page.tsx && echo "FAIL: Hardcoded values remain" || echo "PASS: No hardcoded thresholds"
```
TypeScript compiles:
```bash
npx tsc --noEmit --skipLibCheck 2>&1 | head -20
```
  </verify>
  <done>
- COMPLIANCE_THRESHOLDS, getComplianceStatusLevel, COMPLIANCE_STATUS_METADATA imported from @/types
- getScoreColor function uses getComplianceStatusLevel helper
- getScoreLabel function uses COMPLIANCE_STATUS_METADATA
- No hardcoded threshold values (90, 70) remain in file
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **TypeScript compilation passes:**
   ```bash
   cd "C:\Users\LukeBoustridge\Projects\RANZ\RANZ Quality Program" && npx tsc --noEmit --skipLibCheck
   ```

2. **All UI components import from @/types:**
   ```bash
   grep -l "COMPLIANCE_THRESHOLDS\|getComplianceStatusLevel" src/components/dashboard/compliance-score.tsx src/app/verify/\\[businessId\\]/page.tsx src/app/\\(admin\\)/admin/members/page.tsx
   ```
   Expected: All 3 files listed

3. **No hardcoded 90/70 thresholds in UI components:**
   ```bash
   grep -rn "score >= 90\|score >= 70\|complianceScore >= 90\|complianceScore >= 70" src/components/dashboard/compliance-score.tsx src/app/verify/\\[businessId\\]/page.tsx src/app/\\(admin\\)/admin/members/page.tsx && echo "FAIL" || echo "PASS"
   ```
   Expected: No matches found, "PASS" printed

4. **Application builds:**
   ```bash
   npm run build 2>&1 | tail -20
   ```
</verification>

<success_criteria>
1. compliance-score.tsx imports COMPLIANCE_THRESHOLDS and uses getComplianceStatusLevel for all threshold checks
2. verify/[businessId]/page.tsx imports COMPLIANCE_THRESHOLDS and uses constants for all threshold checks
3. admin/members/page.tsx imports and uses central constants for score color/label functions
4. Zero hardcoded 90 or 70 threshold values remain in any of the three files
5. TypeScript compiles without errors
6. Application builds successfully
</success_criteria>

<output>
After completion, create `.planning/phases/01-compliance-engine-consolidation/01-02-SUMMARY.md`
</output>
